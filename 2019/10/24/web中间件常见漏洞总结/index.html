<!DOCTYPE html>
<html lang="zh-CN">
    <!-- title -->




<!-- keywords -->




<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="申子昊">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="申子昊">
    
    <meta name="keywords" content=",,">
    
    <meta name="description" content="多一份网络防护技能,多一份信息安全保证">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>web中间件常见漏洞总结 · himawari&#39;Blog</title>
    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }

</style>

    <link rel="preload" href="/css/style.css?v=20180824" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="/css/mobile.css?v=20180824" media="(max-width: 980px)">
    
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
(function( w ){
	"use strict";
	// rel=preload support test
	if( !w.loadCSS ){
		w.loadCSS = function(){};
	}
	// define on the loadCSS obj
	var rp = loadCSS.relpreload = {};
	// rel=preload feature support test
	// runs once and returns a function for compat purposes
	rp.support = (function(){
		var ret;
		try {
			ret = w.document.createElement( "link" ).relList.supports( "preload" );
		} catch (e) {
			ret = false;
		}
		return function(){
			return ret;
		};
	})();

	// if preload isn't supported, get an asynchronous load by using a non-matching media attribute
	// then change that media back to its intended value on load
	rp.bindMediaToggle = function( link ){
		// remember existing media attr for ultimate state, or default to 'all'
		var finalMedia = link.media || "all";

		function enableStylesheet(){
			link.media = finalMedia;
		}

		// bind load handlers to enable media
		if( link.addEventListener ){
			link.addEventListener( "load", enableStylesheet );
		} else if( link.attachEvent ){
			link.attachEvent( "onload", enableStylesheet );
		}

		// Set rel and non-applicable media type to start an async request
		// note: timeout allows this to happen async to let rendering continue in IE
		setTimeout(function(){
			link.rel = "stylesheet";
			link.media = "only x";
		});
		// also enable media after 3 seconds,
		// which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
		setTimeout( enableStylesheet, 3000 );
	};

	// loop through link elements in DOM
	rp.poly = function(){
		// double check this to prevent external calls from running
		if( rp.support() ){
			return;
		}
		var links = w.document.getElementsByTagName( "link" );
		for( var i = 0; i < links.length; i++ ){
			var link = links[ i ];
			// qualify links to those with rel=preload and as=style attrs
			if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
				// prevent rerunning on link
				link.setAttribute( "data-loadcss", true );
				// bind listeners to toggle media back
				rp.bindMediaToggle( link );
			}
		}
	};

	// if unsupported, run the polyfill
	if( !rp.support() ){
		// run once at least
		rp.poly();

		// rerun poly on an interval until onload
		var run = w.setInterval( rp.poly, 500 );
		if( w.addEventListener ){
			w.addEventListener( "load", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		} else if( w.attachEvent ){
			w.attachEvent( "onload", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		}
	}


	// commonjs
	if( typeof exports !== "undefined" ){
		exports.loadCSS = loadCSS;
	}
	else {
		w.loadCSS = loadCSS;
	}
}( typeof global !== "undefined" ? global : this ) );
</script>

    <link rel="icon" href="/assets/favicon.ico">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" as="script">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js" as="script">
    <link rel="preload" as="font" href="/font/Oswald-Regular.ttf" crossorigin>
    <link rel="preload" as="font" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" crossorigin>
    
    <!-- fancybox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script>
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
</head>

    
        <body class="post-body">
    
    
<header class="header">

    <div class="read-progress"></div>
    <div class="header-sidebar-menu">&#xe775;</div>
    <!-- post页的toggle banner  -->
    
    <div class="banner">
            <div class="blog-title">
                <a href="/" >himawari&#39;Blog</a>
            </div>
            <div class="post-title">
                <a href="#" class="post-name">web中间件常见漏洞总结</a>
            </div>
    </div>
    
    <a class="home-link" href=/>himawari'Blog</a>
</header>
    <div class="wrapper">
        <div class="site-intro" style="







height:50vh;
">
    
    <!-- 主页  -->
    
    
    <!-- 404页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/beijing.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
            web中间件常见漏洞总结
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
            
            <!-- 404 -->
            
        </p>
        <!-- 文章页meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                    <div class= post-intro-tags >
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "web中间件">web中间件</a>
    
</div>
                
                
                    <div class="post-intro-read">
                        <span>字数统计: <span class="post-count word-count">5.3k</span>阅读时长: <span class="post-count reading-time">20 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <span class="post-intro-calander iconfont-archer">&#xe676;</span>
                    <span class="post-intro-time">2019/10/24</span>
                    
                    <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                        <span class="iconfont-archer">&#xe602;</span>
                        <span id="busuanzi_value_page_pv"></span>
                    </span>
                    
                    <span class="shareWrapper">
                        <span class="iconfont-archer shareIcon">&#xe71d;</span>
                        <span class="shareText">Share</span>
                        <ul class="shareList">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>
        <script>
 
  // get user agent
  var browser = {
    versions: function () {
      var u = window.navigator.userAgent;
      return {
        userAgent: u,
        trident: u.indexOf('Trident') > -1, //IE内核
        presto: u.indexOf('Presto') > -1, //opera内核
        webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
        mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
        iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
        iPad: u.indexOf('iPad') > -1, //是否为iPad
        webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
        weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
        uc: u.indexOf('UCBrowser') > -1 //是否为android下的UC浏览器
      };
    }()
  }
  console.log("userAgent:" + browser.versions.userAgent);

  // callback
  function fontLoaded() {
    console.log('font loaded');
    if (document.getElementsByClassName('site-intro-meta')) {
      document.getElementsByClassName('intro-title')[0].classList.add('intro-fade-in');
      document.getElementsByClassName('intro-subtitle')[0].classList.add('intro-fade-in');
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in');
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb(){
    if (browser.versions.uc) {
      console.log("UCBrowser");
      fontLoaded();
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular']
        },
        loading: function () {  //所有字体开始加载
          // console.log('loading');
        },
        active: function () {  //所有字体已渲染
          fontLoaded();
        },
        inactive: function () { //字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout');
          fontLoaded();
        },
        timeout: 5000 // Set the timeout to two seconds
      });
    }
  }

  function asyncErr(){
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (cb) { o.addEventListener('load', function (e) { cb(null, e); }, false); }
    if (err) { o.addEventListener('error', function (e) { err(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }

  var asyncLoadWithFallBack = function(arr, success, reject) {
      var currReject = function(){
        reject()
        arr.shift()
        if(arr.length)
          async(arr[0], success, currReject)
        }

      async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack([
    "https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js", 
    "https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js",
    "/lib/webfontloader.min.js"
  ], asyncCb, asyncErr)
</script>        
        <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
        <div class="container container-unloaded">
            <main class="main post-page">
    <article class="article-entry">
        <h2 id="一、-常见web中间件及其漏洞概述"><a href="#一、-常见web中间件及其漏洞概述" class="headerlink" title="一、 常见web中间件及其漏洞概述"></a>一、 常见web中间件及其漏洞概述</h2><h3 id="（一）-IIS"><a href="#（一）-IIS" class="headerlink" title="（一） IIS"></a>（一） IIS</h3><p>1、PUT漏洞</p>
<p>2、短文件名猜解</p>
<p>3、远程代码执行</p>
<p>4、解析漏洞</p>
<h3 id="（二）-Apache"><a href="#（二）-Apache" class="headerlink" title="（二） Apache"></a>（二） Apache</h3><p>1、解析漏洞</p>
<p>2、目录遍历</p>
<h3 id="（三）-Nginx"><a href="#（三）-Nginx" class="headerlink" title="（三） Nginx"></a>（三） Nginx</h3><p>1、文件解析</p>
<p>2、目录遍历</p>
<p>3、CRLF注入</p>
<p>4、目录穿越</p>
<h3 id="（四）Tomcat"><a href="#（四）Tomcat" class="headerlink" title="（四）Tomcat"></a>（四）Tomcat</h3><p>1、远程代码执行</p>
<p>2、war后门文件部署</p>
<h3 id="（五）jBoss"><a href="#（五）jBoss" class="headerlink" title="（五）jBoss"></a>（五）jBoss</h3><p>1、反序列化漏洞</p>
<p>2、war后门文件部署</p>
<h3 id="（六）WebLogic"><a href="#（六）WebLogic" class="headerlink" title="（六）WebLogic"></a>（六）WebLogic</h3><p>1、反序列化漏洞</p>
<p>2、SSRF</p>
<p>3、任意文件上传</p>
<p>4、war后门文件部署</p>
<h3 id="（七）其它中间件相关漏洞"><a href="#（七）其它中间件相关漏洞" class="headerlink" title="（七）其它中间件相关漏洞"></a>（七）其它中间件相关漏洞</h3><p>1、FastCGI未授权访问、任意命令执行</p>
<p>2、PHPCGI远程代码执行</p>
<h2 id="二、-IIS漏洞分析"><a href="#二、-IIS漏洞分析" class="headerlink" title="二、 IIS漏洞分析"></a>二、 IIS漏洞分析</h2><h3 id="（一）-IIS简介"><a href="#（一）-IIS简介" class="headerlink" title="（一） IIS简介"></a>（一） IIS简介</h3><p>IIS是Internet Information Services的缩写，意为互联网信息服务，是由微软公司提供的基于运行Microsoft  Windows的互联网基本服务。最初是Windows NT版本的可选包，随后内置在Windows 2000、Windows XP  Professional和Windows Server 2003一起发行，但在Windows XP  Home版本上并没有IIS。IIS是一种Web（网页）服务组件，其中包括Web服务器、FTP服务器、NNTP服务器和SMTP服务器，分别用于网页浏览、文件传输、新闻服务和邮件发送等方面，它使得在网络（包括互联网和局域网）上发布信息成了一件很容易的事。</p>
<p>IIS的安全脆弱性曾长时间被业内诟病，一旦IIS出现远程执行漏洞威胁将会非常严重。远程执行代码漏洞存在于 HTTP 协议堆栈  (HTTP.sys) 中，当 HTTP.sys 未正确分析经特殊设计的 HTTP  请求时会导致此漏洞。成功利用此漏洞的攻击者可以在系统帐户的上下文中执行任意代码，可以导致IIS服务器所在机器蓝屏或读取其内存中的机密数据</p>
<h3 id="（二）-PUT漏洞"><a href="#（二）-PUT漏洞" class="headerlink" title="（二） PUT漏洞"></a>（二） PUT漏洞</h3><p><strong>1、漏洞介绍及成因</strong></p>
<p>IIS Server 在 Web 服务扩展中开启了 WebDAV ，配置了可以写入的权限，造成任意文件上传。</p>
<p>版本： IIS6.0</p>
<p><strong>2、漏洞复现</strong></p>
<p>1） 开启WebDAV 和写权限</p>
<p><a href="https://image.3001.net/images/20181216/1544954468_5c162264b3e77.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954468_5c162264b3e77.png!small" alt="img"></a></p>
<p><a href="https://image.3001.net/images/20181216/1544954489_5c16227975735.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954489_5c16227975735.png!small" alt="img"></a></p>
<p>2） 利用burp测试</p>
<p>抓包，将GET请求改为OPTIONS</p>
<p><a href="https://image.3001.net/images/20181216/1544954500_5c162284754a0.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954500_5c162284754a0.png!small" alt="img"></a></p>
<p>3）利用工具进行测试</p>
<p><a href="https://image.3001.net/images/20181216/1544954508_5c16228cd082b.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954508_5c16228cd082b.png!small" alt="img"></a></p>
<p>成功上传，再上传一句话木马，然后用菜刀连接，getshell</p>
<p><a href="https://image.3001.net/images/20181216/1544954522_5c16229a1787c.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954522_5c16229a1787c.png!small" alt="img"></a></p>
<p><strong>3、漏洞修复</strong></p>
<p>关闭WebDAV 和写权限</p>
<h3 id="（二）短文件名猜解"><a href="#（二）短文件名猜解" class="headerlink" title="（二）短文件名猜解"></a>（二）短文件名猜解</h3><p><strong>1、漏洞介绍及成因</strong></p>
<p>IIS的短文件名机制，可以暴力猜解短文件名，访问构造的某个存在的短文件名，会返回404，访问构造的某个不存在的短文件名，返回400。</p>
<p><strong>2、漏洞复现</strong></p>
<p>1）、在网站根目录下添加aaaaaaaaaa.html文件</p>
<p><a href="https://image.3001.net/images/20181216/1544954542_5c1622ae9bc64.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954542_5c1622ae9bc64.png!small" alt="img"></a></p>
<p>3） 进行猜解</p>
<p><a href="https://image.3001.net/images/20181216/1544954552_5c1622b8d255e.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954552_5c1622b8d255e.png!small" alt="img"></a></p>
<p><a href="https://image.3001.net/images/20181216/1544954584_5c1622d80a9c8.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954584_5c1622d80a9c8.png!small" alt="img"></a></p>
<p><strong>3、漏洞修复</strong></p>
<p>修复方法：</p>
<p>1）升级.net framework</p>
<p>2）修改注册表禁用短文件名功能</p>
<p>快捷键Win+R打开命令窗口，输入regedit打开注册表窗口，找到路径：</p>
<p>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem，将其中的  NtfsDisable8dot3NameCreation这一项的值设为 1，1代表不创建短文件名格式，修改完成后，需要重启系统生效</p>
<p>3）CMD关闭NTFS 8.3文件格式的支持</p>
<p>4）将web文件夹的内容拷贝到另一个位置，如c:\www到d:\w,然后删除原文件夹，再重命名d:\w到c:\www。</p>
<p>修复后：</p>
<p><a href="https://image.3001.net/images/20181216/1544954597_5c1622e59d557.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954597_5c1622e59d557.png!small" alt="img"></a></p>
<p><strong>4、局限性</strong></p>
<p>1) 此漏洞只能确定前6个字符，如果后面的字符太长、包含特殊字符，很难猜解；</p>
<p>2) 如果文件名本身太短（无短文件名）也是无法猜解的；</p>
<p>3) 如果文件名前6位带空格，8.3格式的短文件名会补进，和真实文件名不匹配；</p>
<h3 id="（三）-远程代码执行"><a href="#（三）-远程代码执行" class="headerlink" title="（三） 远程代码执行"></a>（三） 远程代码执行</h3><p><strong>1、 漏洞介绍及成因</strong></p>
<p>在IIS6.0处理PROPFIND指令的时候，由于对url的长度没有进行有效的长度控制和检查，导致执行memcpy对虚拟路径进行构造的时候，引发栈溢出，从而导致远程代码执行。</p>
<p><strong>2、 漏洞复现</strong></p>
<p>1）漏洞环境搭建</p>
<p>在windows server 2003 r2 32位上安装iis6.0</p>
<p>2） 触发漏洞</p>
<p>在本地执行exp，exp如下</p>
<p><a href="https://image.3001.net/images/20181216/1544954632_5c1623084ecaa.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954632_5c1623084ecaa.png!small" alt="img"></a></p>
<p>执行成功后，服务器端弹出计算器：</p>
<p><a href="https://image.3001.net/images/20181216/1544954644_5c162314621a4.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954644_5c162314621a4.png!small" alt="img"></a></p>
<p><strong>3、 漏洞修复</strong></p>
<p>1）关闭 WebDAV 服务</p>
<p>2） 使用相关防护设备</p>
<h3 id="（四）-解析漏洞"><a href="#（四）-解析漏洞" class="headerlink" title="（四） 解析漏洞"></a>（四） 解析漏洞</h3><p><strong>1、 漏洞介绍及成因</strong></p>
<p>IIS 6.0 在处理含有特殊符号的文件路径时会出现逻辑错误，从而造成文件解析漏洞。这一漏洞有两种完全不同的利用方式：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">test</span>.asp/<span class="keyword">test</span>.jpgtest.asp;.jpg</span><br></pre></td></tr></table></figure>

<p><strong>2、漏洞复现</strong></p>
<p>利用方式 1</p>
<p>第一种是新建一个名为 “test.asp” 的目录，该目录中的任何文件都被 IIS 当作 asp 程序执行（特殊符号是 “/” ）</p>
<p><a href="https://image.3001.net/images/20181216/1544954672_5c162330306e1.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954672_5c162330306e1.png!small" alt="img"></a></p>
<p>利用方式 2</p>
<p>第二种是上传名为 “test.asp;.jpg” 的文件，虽然该文件真正的后缀名是 “.jpg”, 但由于含有特殊符号 “;” ，仍会被 IIS 当做 asp 程序执行</p>
<p><a href="https://image.3001.net/images/20181216/1544954681_5c162339092fb.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954681_5c162339092fb.png!small" alt="img"></a></p>
<p>IIS7.5 文件解析漏洞</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">test</span>.jpg/.php</span><br></pre></td></tr></table></figure>

<p>URL 中文件后缀是 .php ，便无论该文件是否存在，都直接交给 php 处理，而 php 又默认开启  “cgi.fix_pathinfo”, 会对文件进行 “ 修理 ” ，可谓 “ 修理 ” ？举个例子，当 php 遇到路径  “/aaa.xxx/bbb.yyy” 时，若 “/aaa.xxx/bbb.yyy” 不存在，则会去掉最后的 “bbb.yyy” ，然后判断  “/aaa.xxx” 是否存在，若存在，则把 “/aaa.xxx” 当作文件。</p>
<p>若有文件 test.jpg ，访问时在其后加 /.php ，便可以把 “test.jpg/.php” 交给 php ， php 修理文件路径 “test.jpg/.php” 得到 ”test.jpg” ，该文件存在，便把该文件作为 php 程序执行了。</p>
<p><strong>3、 漏洞修复</strong></p>
<p>1）对新建目录文件名进行过滤，不允许新建包含‘.’的文件</p>
<p>2）曲线网站后台新建目录的功能，不允许新建目录</p>
<p>3）限制上传的脚本执行权限，不允许执行脚本</p>
<p>4）过滤.asp/xm.jpg，通过ISApi组件过滤</p>
<h2 id="三、-Apache漏洞分析"><a href="#三、-Apache漏洞分析" class="headerlink" title="三、 Apache漏洞分析"></a>三、 Apache漏洞分析</h2><h3 id="（一）-Apache简介"><a href="#（一）-Apache简介" class="headerlink" title="（一） Apache简介"></a>（一） Apache简介</h3><p>Apache 是世界使用排名第一的Web 服务器软件。它可以运行在几乎所有广泛使用的 计算机平台上，由于其 跨平台  和安全性被广泛使用，是最流行的Web服务器端软件之一。它快速、可靠并且可通过简单的API扩充，将 Perl/ Python等  解释器编译到服务器中。</p>
<h3 id="（二）-解析漏洞"><a href="#（二）-解析漏洞" class="headerlink" title="（二） 解析漏洞"></a>（二） 解析漏洞</h3><p><strong>1、 漏洞介绍及成因</strong></p>
<p>Apache文件解析漏洞与用户的配置有密切关系，严格来说属于用户配置问题。</p>
<p>Apache文件解析漏洞涉及到一个解析文件的特性：</p>
<p>Apache默认一个文件可以有多个以点分隔的后缀，当右边的后缀无法识别（不在mime.tyoes内），则继续向左识别，当我们请求这样一个文件：shell.xxx.yyy</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">yyy</span>-&gt;</span>无法识别，向左<span class="function"><span class="title">xxx</span>-&gt;</span>无法识别，向左</span><br></pre></td></tr></table></figure>

<p>php-&gt;发现后缀是php，交给php处理这个文件</p>
<p><strong>2、 漏洞复现</strong></p>
<p>上传一个后缀名为360的php文件</p>
<p><a href="https://image.3001.net/images/20181216/1544954824_5c1623c8ad26c.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954824_5c1623c8ad26c.png!small" alt="img"></a></p>
<p><strong>3、 漏洞修复</strong></p>
<p>将AddHandler application/x-httpd-php .php的配置文件删除。</p>
<h3 id="（三）-目录遍历"><a href="#（三）-目录遍历" class="headerlink" title="（三） 目录遍历"></a>（三） 目录遍历</h3><p><strong>1、 漏洞介绍及成因</strong></p>
<p>由于配置错误导致的目录遍历</p>
<p><strong>2、 漏洞复现</strong></p>
<p><a href="https://image.3001.net/images/20181216/1544954845_5c1623dd062fa.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954845_5c1623dd062fa.png!small" alt="img"></a></p>
<p><strong>3、 漏洞修复</strong></p>
<p>修改apache配置文件httpd.conf</p>
<p>找到Options+Indexes+FollowSymLinks +ExecCGI并修改成 Options-Indexes+FollowSymLinks +ExecCGI 并保存；</p>
<p><a href="https://image.3001.net/images/20181216/1544954862_5c1623eee9f99.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954862_5c1623eee9f99.png!small" alt="img"></a></p>
<p><a href="https://image.3001.net/images/20181216/1544954870_5c1623f62f920.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954870_5c1623f62f920.png!small" alt="img"></a></p>
<h2 id="四、-Nginx漏洞分析"><a href="#四、-Nginx漏洞分析" class="headerlink" title="四、 Nginx漏洞分析"></a>四、 Nginx漏洞分析</h2><h3 id="（一）-Nginx简介"><a href="#（一）-Nginx简介" class="headerlink" title="（一） Nginx简介"></a>（一） Nginx简介</h3><p>Nginx 是一款 轻量级的 Web 服务器、 反向代理 服务器及 电子邮件（IMAP/POP3）代理服务器，并在一个BSD-like 协议下发行。其特点是占有内存少， 并发能力强，事实上nginx的并发能力确实在同类型的网页服务器中表现较好</p>
<h3 id="（二）文件解析"><a href="#（二）文件解析" class="headerlink" title="（二）文件解析"></a>（二）文件解析</h3><p><strong>1、 漏洞介绍及成因</strong></p>
<p>对任意文件名，在后面添加/任意文件名.php的解析漏洞，比如原本文件名是test.jpg，可以添加test.jpg/x.php进行解析攻击。</p>
<p><strong>2、 漏洞复现</strong></p>
<p>在网站根目录下新建一个i.gif的文件，在里面写入phpinfo()</p>
<p>在浏览器中打开</p>
<p><a href="https://image.3001.net/images/20181216/1544954886_5c162406b3984.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954886_5c162406b3984.png!small" alt="img"></a></p>
<p>利用文件解析漏洞，输入192.168.139.129:100/i.gif.2.php,发现无法解析</p>
<p><a href="https://image.3001.net/images/20181216/1544954897_5c162411a7874.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954897_5c162411a7874.png!small" alt="img"></a></p>
<p>将/etc/php5/fpm/pool.d/<a href="http://www.conf" target="_blank" rel="noopener">www.conf</a>中security.limit_extensions = .php中的.php删除</p>
<p><a href="https://image.3001.net/images/20181216/1544954906_5c16241ae051f.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954906_5c16241ae051f.png!small" alt="img"></a></p>
<p>再次在浏览器中打开，成功解析</p>
<p><a href="https://image.3001.net/images/20181216/1544954915_5c162423d8916.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954915_5c162423d8916.png!small" alt="img"></a></p>
<p><strong>3、 漏洞修复</strong></p>
<p>1） 将php.ini文件中的cgi.fix_pathinfo的值设为0.这样php在解析1.php/1.jpg这样的目录时，只要1.jpg不存在就会显示404；</p>
<p>2） 将/etc/php5/fpm/pool.d/<a href="http://www.conf" target="_blank" rel="noopener">www.conf</a>中security.limit_ectensions后面的值设为.php</p>
<h3 id="（三）目录遍历"><a href="#（三）目录遍历" class="headerlink" title="（三）目录遍历"></a>（三）目录遍历</h3><p><strong>1、 漏洞简介及成因</strong></p>
<p>Nginx的目录遍历与Apache一样，属于配置方面的问题，错误的配置可到导致目录遍历与源码泄露‘</p>
<p><strong>2、 漏洞复现</strong></p>
<p>打开test目录，发现无法打开</p>
<p><a href="https://image.3001.net/images/20181216/1544954939_5c16243b564a5.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954939_5c16243b564a5.png!small" alt="img"></a></p>
<p>修改/etc/nginx/sites-avaliable/default，在如下图所示的位置添加autoindex on</p>
<p><a href="https://image.3001.net/images/20181216/1544954951_5c1624474d49a.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954951_5c1624474d49a.png!small" alt="img"></a></p>
<p>再次访问</p>
<p><a href="https://image.3001.net/images/20181216/1544954962_5c162452ad7b8.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954962_5c162452ad7b8.png!small" alt="img"></a></p>
<p><strong>3、 漏洞修复</strong></p>
<p>将/etc/nginx/sites-avaliable/default里的autoindex on改为autoindex off</p>
<h3 id="（四）-CRLF注入"><a href="#（四）-CRLF注入" class="headerlink" title="（四） CRLF注入"></a>（四） CRLF注入</h3><p><strong>1、 漏洞简介及成因</strong></p>
<p>CRLF时“回车+换行”（\r\n）的简称。</p>
<p>HTTP Header与HTTP Body时用两个CRLF分隔的，浏览器根据两个CRLF来取出HTTP内容并显示出来。</p>
<p>通过控制HTTP消息头中的字符，注入一些恶意的换行，就能注入一些会话cookie或者html代码，由于Nginx配置不正确，导致注入的代码会被执行。</p>
<p><strong>2、 漏洞复现</strong></p>
<p>访问页面，抓包</p>
<p>请求加上/%0d%0a%0d%0a<img src="/24/web中间件常见漏洞总结/1" onerror="alert(/xss/)"></p>
<p><a href="https://image.3001.net/images/20181216/1544954974_5c16245ee78f0.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544954974_5c16245ee78f0.png!small" alt="img"></a></p>
<p>由于页面重定向，并没有弹窗。</p>
<p><strong>3、 漏洞修复</strong></p>
<p>Nginx的配置文件/etc/nginx/conf.d/error1.conf修改为使用不解码的url跳转。</p>
<h3 id="（五）-目录穿越"><a href="#（五）-目录穿越" class="headerlink" title="（五） 目录穿越"></a>（五） 目录穿越</h3><p><strong>1、 漏洞简介及成因</strong></p>
<p>Nginx反向代理，静态文件存储在/home/下，而访问时需要在url中输入files，配置文件中/files没有用/闭合，导致可以穿越至上层目录。</p>
<p><strong>2、 漏洞复现</strong></p>
<p>访问：<a href="http://192.168.139.128:8081/files/" target="_blank" rel="noopener">http://192.168.139.128:8081/files/</a></p>
<p><a href="https://image.3001.net/images/20181216/1544955023_5c16248f1b4df.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955023_5c16248f1b4df.png!small" alt="img"></a></p>
<p>访问：<a href="http://192.168.139.128:8081/files../" target="_blank" rel="noopener">http://192.168.139.128:8081/files../</a></p>
<p>成功实现目录穿越：</p>
<p><a href="https://image.3001.net/images/20181216/1544955058_5c1624b2016aa.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955058_5c1624b2016aa.png!small" alt="img"></a></p>
<p><strong>3、 漏洞修复</strong></p>
<p>Nginx的配置文件/etc/nginx/conf.d/error2.conf的/files使用/闭合。</p>
<h2 id="五、-Tomcat漏洞分析"><a href="#五、-Tomcat漏洞分析" class="headerlink" title="五、 Tomcat漏洞分析"></a>五、 Tomcat漏洞分析</h2><h3 id="（一）-Tomcat简介"><a href="#（一）-Tomcat简介" class="headerlink" title="（一） Tomcat简介"></a>（一） Tomcat简介</h3><p>Tomcat 服务器是一个免费的开放源代码的Web 应用服务器，属于轻量级应用  服务器，在中小型系统和并发访问用户不是很多的场合下被普遍使用，是开发和调试JSP  程序的首选。对于一个初学者来说，可以这样认为，当在一台机器上配置好Apache 服务器，可利用它响应 HTML （  标准通用标记语言下的一个应用）页面的访问请求。实际上Tomcat是Apache 服务器的扩展，但运行时它是独立运行的，所以当运行tomcat  时，它实际上作为一个与Apache 独立的进程单独运行的。</p>
<h3 id="（二）-远程代码执行"><a href="#（二）-远程代码执行" class="headerlink" title="（二） 远程代码执行"></a>（二） 远程代码执行</h3><p><strong>1、 漏洞简介及成因</strong></p>
<p>Tomcat 运行在Windows 主机上，且启用了 HTTP PUT 请求方法，可通过构造的攻击请求向服务器上传包含任意代码的 JSP 文件，造成任意代码执行。</p>
<p>影响版本： Apache Tomcat 7.0.0 – 7.0.81</p>
<p><strong>2、 漏洞复现</strong></p>
<p>配置漏洞，开启put方法可上传文件功能。</p>
<p>tomcat文件夹下的/conf/web.xml文件插入：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;init-<span class="built_in">param</span>&gt;           &lt;<span class="built_in">param</span>-name&gt;readonly&lt;/<span class="built_in">param</span>-name&gt;           &lt;<span class="built_in">param</span>-<span class="built_in">value</span>&gt;<span class="literal">false</span>&lt;/<span class="built_in">param</span>-<span class="built_in">value</span>&gt;     &lt;/init-<span class="built_in">param</span>&gt;</span><br></pre></td></tr></table></figure>

<p>重启tomcat服务。</p>
<p><a href="https://image.3001.net/images/20181216/1544955083_5c1624cb8ac8a.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955083_5c1624cb8ac8a.png!small" alt="img"></a></p>
<p>访问127.0.0.1：8080，burp抓包，send to Repeater，将请求方式改为PUT，创建一个122.jsp，并用%20转义空格字符。123.jsp内容为：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="module-access"><span class="module"><span class="identifier">Runtime</span>.</span></span>get<span class="constructor">Runtime()</span>.exec(request.get<span class="constructor">Parameter(<span class="string">"cmd"</span>)</span>);%&gt;</span><br></pre></td></tr></table></figure>

<p>返回201，说明创建成功。</p>
<p><a href="https://image.3001.net/images/20181216/1544955095_5c1624d7b5447.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955095_5c1624d7b5447.png!small" alt="img"></a></p>
<p>访问127.0.0.1：8080/122.jsp?cmd=calc。</p>
<p>弹出计算器：</p>
<p><a href="https://image.3001.net/images/20181216/1544955107_5c1624e39d5ed.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955107_5c1624e39d5ed.png!small" alt="img"></a></p>
<p><strong>3、 漏洞修复</strong></p>
<p>1）检测当前版本是否在影响范围内，并禁用PUT方法。</p>
<p>2）更新并升级至最新版。</p>
<h3 id="（三）war后门文件部署"><a href="#（三）war后门文件部署" class="headerlink" title="（三）war后门文件部署"></a>（三）war后门文件部署</h3><p><strong>1、漏洞简介及成因</strong></p>
<p>Tomcat 支持在后台部署war文件，可以直接将webshell部署到web目录下。</p>
<p>若后台管理页面存在弱口令，则可以通过爆破获取密码。</p>
<p><strong>2、漏洞复现</strong></p>
<p>Tomcat安装目录下conf里的tomcat-users.xml配置如下：</p>
<p><a href="https://image.3001.net/images/20181216/1544955120_5c1624f0e6795.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955120_5c1624f0e6795.png!small" alt="img"></a></p>
<p>访问后台，登陆：</p>
<p><a href="https://image.3001.net/images/20181216/1544955131_5c1624fb87534.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955131_5c1624fb87534.png!small" alt="img"></a></p>
<p>上传一个war包，里面是jsp后门：</p>
<p><a href="https://image.3001.net/images/20181216/1544955146_5c16250a9c859.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955146_5c16250a9c859.png!small" alt="img"></a></p>
<p>成功上传并解析，打开：</p>
<p><a href="https://image.3001.net/images/20181216/1544955158_5c162516bfdc4.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955158_5c162516bfdc4.png!small" alt="img"></a></p>
<p>可执行系统命令：</p>
<p><a href="https://image.3001.net/images/20181216/1544955173_5c162525a51ea.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955173_5c162525a51ea.png!small" alt="img"></a></p>
<p>也可进行文件管理，任意查看、删除、上传文件：</p>
<p><a href="https://image.3001.net/images/20181216/1544955183_5c16252f655db.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955183_5c16252f655db.png!small" alt="img"></a></p>
<p><strong>3、漏洞修复</strong></p>
<p>1）在系统上以低权限运行Tomcat应用程序。创建一个专门的 Tomcat服务用户，该用户只能拥有一组最小权限（例如不允许远程登录）。</p>
<p>2）增加对于本地和基于证书的身份验证，部署账户锁定机制（对于集中式认证，目录服务也要做相应配置）。在CATALINA_HOME/conf/web.xml文件设置锁定机制和时间超时限制。</p>
<p>3）以及针对manager-gui/manager-status/manager-script等目录页面设置最小权限访问限制。</p>
<p>4）后台管理避免弱口令。</p>
<h2 id="六、-jBoss漏洞分析"><a href="#六、-jBoss漏洞分析" class="headerlink" title="六、 jBoss漏洞分析"></a>六、 jBoss漏洞分析</h2><h3 id="（一）-jBoss简介"><a href="#（一）-jBoss简介" class="headerlink" title="（一） jBoss简介"></a>（一） jBoss简介</h3><p>jBoss是一个基于J2EE的开发源代码的应用服务器。  JBoss代码遵循LGPL许可，可以在任何商业应用中免费使用。JBoss是一个管理EJB的容器和服务器，支持EJB1.1、EJB  2.0和EJB3的规范。但JBoss核心服务不包括支持servlet/JSP的WEB容器，一般与Tomcat或Jetty绑定使用。</p>
<h3 id="（二）-反序列化漏洞"><a href="#（二）-反序列化漏洞" class="headerlink" title="（二） 反序列化漏洞"></a>（二） 反序列化漏洞</h3><p><strong>1、 漏洞介绍及成因</strong></p>
<p>Java序列化，简而言之就是把java对象转化为字节序列的过程。而反序列话则是再把字节序列恢复为java对象的过程，然而就在这一转一变得过程中，程序员的过滤不严格，就可以导致恶意构造的代码的实现。</p>
<p><strong>2、 漏洞复现</strong></p>
<p>靶机启动jboss。</p>
<p>攻击机访问靶机服务：</p>
<p><a href="https://image.3001.net/images/20181216/1544955201_5c16254132af8.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955201_5c16254132af8.png!small" alt="img"></a></p>
<p>访问/invoker/readonly。</p>
<p>返回500，说明页面存在，此页面有反序列化漏洞：</p>
<p><a href="https://image.3001.net/images/20181216/1544955212_5c16254c54a5e.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955212_5c16254c54a5e.png!small" alt="img"></a></p>
<p>抓包：</p>
<p><a href="https://image.3001.net/images/20181216/1544955225_5c162559c837c.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955225_5c162559c837c.png!small" alt="img"></a></p>
<p>改包。</p>
<p>POST payload.bin中数据。</p>
<p><a href="https://image.3001.net/images/20181216/1544955253_5c162575ce0a6.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955253_5c162575ce0a6.png!small" alt="img"></a></p>
<p><a href="https://image.3001.net/images/20181216/1544955240_5c162568b8024.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955240_5c162568b8024.png!small" alt="img"></a></p>
<p>查看靶机，弹出计算器。</p>
<p><a href="https://image.3001.net/images/20181216/1544955250_5c1625722d41e.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955250_5c1625722d41e.png!small" alt="img"></a></p>
<p><strong>3、 漏洞修复</strong></p>
<p>有效解决方案：升级到JBOSS AS7版本临时解决方案：</p>
<p>1）不需要http-invoker.sar 组件的用户可直接删除此组件；</p>
<p>2）用于对 httpinvoker 组件进行访问控制。</p>
<h3 id="（三）-war后门文件部署"><a href="#（三）-war后门文件部署" class="headerlink" title="（三） war后门文件部署"></a>（三） war后门文件部署</h3><p><strong>1、 漏洞介绍及成因</strong></p>
<p>jBoss后台管理页面存在弱口令，通过爆破获得账号密码。登陆后台上传包含后门的war包。</p>
<p><strong>2、 漏洞复现</strong></p>
<p><a href="https://image.3001.net/images/20181216/1544955269_5c16258565dca.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955269_5c16258565dca.png!small" alt="img"></a></p>
<p><a href="https://image.3001.net/images/20181216/1544955275_5c16258b733e0.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955275_5c16258b733e0.png!small" alt="img"></a></p>
<p>点击Web Application(war)s。</p>
<p><a href="https://image.3001.net/images/20181216/1544955283_5c16259340980.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955283_5c16259340980.png!small" alt="img"></a></p>
<p>点击add a new resource。</p>
<p><a href="https://image.3001.net/images/20181216/1544955291_5c16259b4b362.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955291_5c16259b4b362.png!small" alt="img"></a></p>
<p>选择一个war包上传，上传后，进入该war包，点击start。</p>
<p><a href="https://image.3001.net/images/20181216/1544955300_5c1625a46f26a.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955300_5c1625a46f26a.png!small" alt="img"></a></p>
<p>查看status为sucessful。</p>
<p><a href="https://image.3001.net/images/20181216/1544955310_5c1625ae165ad.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955310_5c1625ae165ad.png!small" alt="img"></a></p>
<p>访问该war包页面，进入后门。</p>
<p>可进行文件管理和系统命令执行。</p>
<p><a href="https://image.3001.net/images/20181216/1544955318_5c1625b6d0f4c.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955318_5c1625b6d0f4c.png!small" alt="img"></a></p>
<p><a href="https://image.3001.net/images/20181216/1544955328_5c1625c0579fd.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955328_5c1625c0579fd.png!small" alt="img"></a></p>
<h2 id="七、-WebLogic漏洞分析"><a href="#七、-WebLogic漏洞分析" class="headerlink" title="七、 WebLogic漏洞分析"></a>七、 WebLogic漏洞分析</h2><h3 id="（一）-WebLogic简介"><a href="#（一）-WebLogic简介" class="headerlink" title="（一） WebLogic简介"></a>（一） WebLogic简介</h3><p>WebLogic是美国Oracle公司出品的一个applicationserver，确切的说是一个基于JAVAEE架构的中间件，WebLogic是用于开发、集成、部署和管理大型分布式Web应用、网络应用和数据库应用的Java应用服务器。将Java的动态功能和Java  Enterprise标准的安全性引入大型网络应用的开发、集成、部署和管理之中。</p>
<h3 id="（二）-反序列化漏洞-1"><a href="#（二）-反序列化漏洞-1" class="headerlink" title="（二） 反序列化漏洞"></a>（二） 反序列化漏洞</h3><p><strong>1、 漏洞简介及成因</strong></p>
<p>Java序列化，简而言之就是把java对象转化为字节序列的过程。而反序列话则是再把字节序列恢复为java对象的过程，然而就在这一转一变得过程中，程序员的过滤不严格，就可以导致恶意构造的代码的实现。</p>
<p><strong>2、漏洞复现</strong></p>
<p>使用vulhub实验环境，启动实验环境，访问靶机，抓包，修改数据包。</p>
<p><a href="https://image.3001.net/images/20181216/1544955349_5c1625d5f0cfb.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955349_5c1625d5f0cfb.png!small" alt="img"></a></p>
<p>Kali启动监听。</p>
<p>发送数据包成功后，拿到shell。</p>
<p><a href="https://image.3001.net/images/20181216/1544955361_5c1625e14f776.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955361_5c1625e14f776.png!small" alt="img"></a></p>
<p><strong>3、漏洞修复</strong></p>
<p>1）升级Oracle 10月份补丁。</p>
<p>2）对访问wls-wsat的资源进行访问控制。</p>
<h3 id="（三）-SSRF"><a href="#（三）-SSRF" class="headerlink" title="（三） SSRF"></a>（三） SSRF</h3><p><strong>1、 漏洞简介及成因</strong></p>
<p>Weblogic 中存在一个SSRF漏洞，利用该漏洞可以发送任意HTTP请求，进而攻击内网中redis、fastcgi等脆弱组件。</p>
<p><strong>2、 漏洞复现</strong></p>
<p>使用vulhub实验环境，启动环境。</p>
<p>访问<a href="http://192.168.139.129:7001/uddiexplorer/SearchPublicRegistries.jsp。" target="_blank" rel="noopener">http://192.168.139.129:7001/uddiexplorer/SearchPublicRegistries.jsp。</a></p>
<p><a href="https://image.3001.net/images/20181216/1544955373_5c1625edf3c4f.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955373_5c1625edf3c4f.png!small" alt="img"></a></p>
<p>用burp抓包，修改请求。</p>
<p><a href="https://image.3001.net/images/20181216/1544955383_5c1625f70b11d.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955383_5c1625f70b11d.png!small" alt="img"></a></p>
<p>启动nc监听2222端口。</p>
<p><a href="https://image.3001.net/images/20181216/1544955390_5c1625febc7e3.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955390_5c1625febc7e3.png!small" alt="img"></a></p>
<p>拿到shell。</p>
<p><strong>3、 漏洞修复</strong></p>
<p>方法一：</p>
<p>以修复的直接方法是将SearchPublicRegistries.jsp直接删除就好了；</p>
<p>方法二：</p>
<p>1）删除uddiexplorer文件夹</p>
<p>2）限制uddiexplorer应用只能内网访问</p>
<p>方法三：（常用）</p>
<p>Weblogic服务端请求伪造漏洞出现在uddi组件（所以安装Weblogic时如果没有选择uddi组件那么就不会有该漏洞），更准确地说是uudi包实现包uddiexplorer.war下的SearchPublicRegistries.jsp。方法二采用的是改后辍的方式，修复步骤如下：</p>
<p>1）将weblogic安装目录下的wlserver_10.3/server/lib/uddiexplorer.war做好备份</p>
<p>2）将weblogic安装目录下的server/lib/uddiexplorer.war下载</p>
<p>3）用winrar等工具打开uddiexplorer.war</p>
<p>4)将其下的SearchPublicRegistries.jsp重命名为SearchPublicRegistries.jspx</p>
<p>5）保存后上传回服务端替换原先的uddiexplorer.war</p>
<p>6）对于多台主机组成的集群，针对每台主机都要做这样的操作</p>
<p>7）由于每个server的tmp目录下都有缓存所以修改后要彻底重启weblogic（即停应用–停server–停控制台–启控制台–启server–启应用）</p>
<h3 id="（四）-任意文件上传"><a href="#（四）-任意文件上传" class="headerlink" title="（四） 任意文件上传"></a>（四） 任意文件上传</h3><p><strong>1、 漏洞简介及成因</strong></p>
<p>通过访问config.do配置页面，先更改Work Home工作目录，用有效的已部署的Web应用目录替换默认的存储JKS Keystores文件的目录，之后使用”添加Keystore设置”的功能，可上传恶意的JSP脚本文件。</p>
<p><strong>2、 漏洞复现</strong></p>
<p>访问<a href="http://192.168.139.129:7001/ws_utc/config.do。" target="_blank" rel="noopener">http://192.168.139.129:7001/ws_utc/config.do。</a></p>
<p><a href="https://image.3001.net/images/20181216/1544955408_5c162610d485e.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955408_5c162610d485e.png!small" alt="img"></a></p>
<p>设置Work Home  Dir为<code>/u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css</code>。</p>
<p>然后点击安全 -&gt; 增加，然后上传 webshell ，这里我上传一个 jsp 大马。</p>
<p><a href="https://image.3001.net/images/20181216/1544955420_5c16261c14846.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955420_5c16261c14846.png!small" alt="img"></a></p>
<p>上传后，查看返回的数据包，其中有时间戳：</p>
<p><a href="https://image.3001.net/images/20181216/1544955428_5c16262471d61.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955428_5c16262471d61.png!small" alt="img"></a></p>
<p>可以看到时间戳为1543145154632。</p>
<p>访问<a href="http://192.168.139.129:7001/ws_utc/css/config/keystore/1543145154632_lele.jsp。" target="_blank" rel="noopener">http://192.168.139.129:7001/ws_utc/css/config/keystore/1543145154632_lele.jsp。</a></p>
<p>可以进行文件管理、文件上传、系统命令执行等。</p>
<p><a href="https://image.3001.net/images/20181216/1544955438_5c16262ed74a2.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955438_5c16262ed74a2.png!small" alt="img"></a></p>
<p>尝试以下执行系统命令。</p>
<p><a href="https://image.3001.net/images/20181216/1544955446_5c16263615970.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955446_5c16263615970.png!small" alt="img"></a></p>
<p>命令执行成功。</p>
<p><strong>3、 漏洞修复</strong></p>
<p>方案1：</p>
<p>使用Oracle官方通告中的补丁链接：</p>
<p><a href="http://www.oracle.com/technetwork/security-advisory/cpujul2018-4258247.html" target="_blank" rel="noopener">http://www.oracle.com/technetwork/security-advisory/cpujul2018-4258247.html</a></p>
<p><a href="https://support.oracle.com/rs?type=doc&amp;id=2394520.1" target="_blank" rel="noopener">https://support.oracle.com/rs?type=doc&amp;id=2394520.1</a></p>
<p>方案2:</p>
<p>1）进入Weblogic Server管理控制台；</p>
<p>2）domain设置中，启用”生产模式”。</p>
<h3 id="（五）-war后门文件部署"><a href="#（五）-war后门文件部署" class="headerlink" title="（五） war后门文件部署"></a>（五） war后门文件部署</h3><p><strong>1、 漏洞简介及成因</strong></p>
<p>由于WebLogic后台存在弱口令，可直接登陆后台上传包含后门的war包。</p>
<p><strong>2、 漏洞复现</strong></p>
<p>访问<a href="http://192.168.139.129:7001/console" target="_blank" rel="noopener">http://192.168.139.129:7001/console</a></p>
<p><a href="https://image.3001.net/images/20181216/1544955458_5c162642c59ac.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955458_5c162642c59ac.png!small" alt="img"></a></p>
<p>使用弱口令登陆至后台。</p>
<p>点击锁定并编辑。</p>
<p><a href="https://image.3001.net/images/20181216/1544955467_5c16264b0e5ed.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955467_5c16264b0e5ed.png!small" alt="img"></a></p>
<p>选择部署，进一步点击右边的安装。</p>
<p><a href="https://image.3001.net/images/20181216/1544955476_5c162654ad096.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955476_5c162654ad096.png!small" alt="img"></a></p>
<p>点击上传文件 — 进入文件上传界面，选择要上传的 war 包。</p>
<p><a href="https://image.3001.net/images/20181216/1544955485_5c16265d47acf.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955485_5c16265d47acf.png!small" alt="img"></a></p>
<p>进入下一步，选择对应的 war 包进行部署，下一步下一步直至完成。</p>
<p><a href="https://image.3001.net/images/20181216/1544955495_5c16266778cf9.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955495_5c16266778cf9.png!small" alt="img"></a></p>
<p><a href="https://image.3001.net/images/20181216/1544955518_5c16267e4cdda.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955518_5c16267e4cdda.png!small" alt="img"></a></p>
<p><a href="https://image.3001.net/images/20181216/1544955523_5c1626831e3b3.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955523_5c1626831e3b3.png!small" alt="img"></a></p>
<p>点击激活更改。</p>
<p><a href="https://image.3001.net/images/20181216/1544955531_5c16268b6846b.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955531_5c16268b6846b.png!small" alt="img"></a></p>
<p>启动上传的 war 包所生成的服务。</p>
<p><a href="https://image.3001.net/images/20181216/1544955539_5c16269393d67.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955539_5c16269393d67.png!small" alt="img"></a></p>
<p>拿到 webshell。</p>
<p><a href="https://image.3001.net/images/20181216/1544955547_5c16269badc78.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955547_5c16269badc78.png!small" alt="img"></a></p>
<p><strong>3、 漏洞修复</strong></p>
<p>防火墙设置端口过滤，也可以设置只允许访问后台的IP列表，避免后台弱口令。</p>
<h2 id="八、-其它中间件相关漏洞"><a href="#八、-其它中间件相关漏洞" class="headerlink" title="八、 其它中间件相关漏洞"></a>八、 其它中间件相关漏洞</h2><h3 id="（一）-FastCGI未授权访问、任意命令执行"><a href="#（一）-FastCGI未授权访问、任意命令执行" class="headerlink" title="（一） FastCGI未授权访问、任意命令执行"></a>（一） FastCGI未授权访问、任意命令执行</h3><p><strong>1、 漏洞简介及成因</strong></p>
<p>服务端使用fastcgi协议并对外网开放9000端口，可以构造fastcgi协议包内容，实现未授权访问服务端.php文件以及执行任意命令。</p>
<p><strong>2、 漏洞复现</strong></p>
<p>使用vulhub实验环境，启动实验环境。</p>
<p>在攻击机使用命令python fpm.py 192.168.237.136 /etc/passwd，观察返回结果。</p>
<p><a href="https://image.3001.net/images/20181216/1544955569_5c1626b181057.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955569_5c1626b181057.png!small" alt="img"></a></p>
<p>由于访问非*.PHP文件，所以返回结果403。</p>
<p>使用命令执行一个默认存在的 php 文件。</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python fpm.py <span class="number">192.168</span>.<span class="number">237.136</span> /usr/local/<span class="class"><span class="keyword">lib</span>/<span class="title">php</span>/<span class="title">PEAR</span>.<span class="title">php</span></span></span><br></pre></td></tr></table></figure>

<p><a href="https://image.3001.net/images/20181216/1544955581_5c1626bd94566.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955581_5c1626bd94566.png!small" alt="img"></a></p>
<p>利用命令进行任意命令执行复现。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python fpm<span class="selector-class">.py</span> <span class="number">192.168</span>.<span class="number">139.129</span> /usr/local/lib/php/PEAR<span class="selector-class">.php-c</span> <span class="string">'&lt;?php echo `pwd`; ?&gt;'</span>python fpm<span class="selector-class">.py</span> <span class="number">192.168</span>.<span class="number">139.129</span> /usr/local/lib/php/PEAR<span class="selector-class">.php-c</span> <span class="string">'&lt;?php echo `ifconfig`; ?&gt;'</span>python fpm<span class="selector-class">.py</span> <span class="number">192.168</span>.<span class="number">139.129</span> /usr/local/lib/php/PEAR<span class="selector-class">.php-c</span> <span class="string">'&lt;?php echo `ls`; ?&gt;'</span></span><br></pre></td></tr></table></figure>

<p><a href="https://image.3001.net/images/20181216/1544955594_5c1626ca98c2c.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955594_5c1626ca98c2c.png!small" alt="img"></a></p>
<p><strong>3、 漏洞修复</strong></p>
<p>更改默认端口</p>
<h3 id="（二）-PHPCGI远程代码执行"><a href="#（二）-PHPCGI远程代码执行" class="headerlink" title="（二） PHPCGI远程代码执行"></a>（二） PHPCGI远程代码执行</h3><p><strong>1、 漏洞简介及成因</strong></p>
<p>在apache调用php解释器解释.php文件时，会将url参数传我给php解释器，如果在url后加传命令行开关（例如-s、-d 、-c或-dauto_prepend_file%3d/etc/passwd+-n）等参数时，会导致源代码泄露和任意代码执行。</p>
<p>此漏洞影响php-5.3.12以前的版本，mod方式、fpm方式不受影响。</p>
<p><strong>2、 漏洞复现</strong></p>
<p>使用vulhub实验环境，启动环境。</p>
<p>访问<a href="http://192.168.139.129:8080/index.php。" target="_blank" rel="noopener">http://192.168.139.129:8080/index.php。</a></p>
<p><a href="https://image.3001.net/images/20181216/1544955605_5c1626d552e60.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955605_5c1626d552e60.png!small" alt="img"></a></p>
<p>抓包，修改包。</p>
<p><a href="https://image.3001.net/images/20181216/1544955613_5c1626dd7ad9f.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181216/1544955613_5c1626dd7ad9f.png!small" alt="img"></a></p>
<p>命令成功执行。</p>
<p><strong>3、 漏洞修复</strong></p>
<p>三种方法：</p>
<p>1）升级php版本；（php-5.3.12以上版本）;</p>
<p>2）在apache上做文章，开启url过滤，把危险的命令行参数给过滤掉，由于这种方法修补比较简单，采用比较多吧。</p>
<p>具体做法：</p>
<p>修改http.conf文件，找到<directory>增加以下三行</directory></p>
<p>RewriteEngine on</p>
<p>RewriteCond %{QUERY_STRING} ^(%2d|-)[^=]+$ [NC]</p>
<p>RewriteRule ^(.*) $1? [L]</p>
<p>重启一下apache即可，但是要考虑到，相当于每次request就要进行一次url过滤，如果访问量大的话，可能会增加apache的负担。</p>
<p>3）打上php补丁。</p>
<p>补丁下载地址:<a href="https://eindbazen.net/2012/05/php-cgi-advisory-cve-2012-1823/" target="_blank" rel="noopener">https://eindbazen.net/2012/05/php-cgi-advisory-cve-2012-1823/</a></p>
<p>原文链接：</p>
<p><a href="https://www.freebuf.com/articles/web/192063.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/192063.html</a></p>

    </article>
    <!-- license  -->
    
        <div class="license-wrapper">
            <p>原文作者：<a href="blog.shenzihao.top">申子昊</a>
            <p>原文链接：<a href="blog.shenzihao.top/2019/10/24/web中间件常见漏洞总结/">blog.shenzihao.top/2019/10/24/web中间件常见漏洞总结/</a>
            <p>发表日期：<a href="blog.shenzihao.top/2019/10/24/web中间件常见漏洞总结/">October 24th 2019, 9:38:09 am</a>
            <p>更新日期：<a href="blog.shenzihao.top/2019/10/24/web中间件常见漏洞总结/">October 24th 2019, 9:39:31 am</a>
            <p>版权声明：本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator  -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href= "/10007/06/07/日记/" title= "日记">
                    <div class="nextTitle">日记</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href= "/2019/10/24/注入点判断/" title= "注入点判断">
                    <div class="prevTitle">注入点判断</div>
                </a>
            
        </li>
    </ul>
    <!-- 评论插件 -->
    <!-- 来必力City版安装代码 -->

<!-- City版安装代码已完成 -->
    
    
    <!-- partial('_partial/comment/changyan') -->
    <!--PC版-->


    
    

    <!-- 评论 -->
</main>
            <!-- profile -->
            
        </div>
        <footer class="footer footer-unloaded">
    <!-- social  -->
    
    <div class="social">
        
    
        
            
                <a href="mailto:951331714@qq.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="https://github.com/Flash1201" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
            
                <a href="https://weibo.com/3176926602/profile?topnav=1&wvr=6" class="iconfont-archer weibo" target="_blank" title=weibo></a>
            
        
    
        
            
                <a href="https://www.zhihu.com/people/flash-20-93/activities" class="iconfont-archer zhihu" target="_blank" title=zhihu></a>
            
        
    

    </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- 不蒜子  -->
    
    <div class="busuanzi-container">
    
     
    <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
    
    </div>
    
</footer>
    </div>
    <!-- toc -->
    
    <div class="toc-wrapper" style=
    







top:50vh;

    >
        <div class="toc-catalog">
            <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
        </div>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、-常见web中间件及其漏洞概述"><span class="toc-number">1.</span> <span class="toc-text">一、 常见web中间件及其漏洞概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（一）-IIS"><span class="toc-number">1.1.</span> <span class="toc-text">（一） IIS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（二）-Apache"><span class="toc-number">1.2.</span> <span class="toc-text">（二） Apache</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（三）-Nginx"><span class="toc-number">1.3.</span> <span class="toc-text">（三） Nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（四）Tomcat"><span class="toc-number">1.4.</span> <span class="toc-text">（四）Tomcat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（五）jBoss"><span class="toc-number">1.5.</span> <span class="toc-text">（五）jBoss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（六）WebLogic"><span class="toc-number">1.6.</span> <span class="toc-text">（六）WebLogic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（七）其它中间件相关漏洞"><span class="toc-number">1.7.</span> <span class="toc-text">（七）其它中间件相关漏洞</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、-IIS漏洞分析"><span class="toc-number">2.</span> <span class="toc-text">二、 IIS漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（一）-IIS简介"><span class="toc-number">2.1.</span> <span class="toc-text">（一） IIS简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（二）-PUT漏洞"><span class="toc-number">2.2.</span> <span class="toc-text">（二） PUT漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（二）短文件名猜解"><span class="toc-number">2.3.</span> <span class="toc-text">（二）短文件名猜解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（三）-远程代码执行"><span class="toc-number">2.4.</span> <span class="toc-text">（三） 远程代码执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（四）-解析漏洞"><span class="toc-number">2.5.</span> <span class="toc-text">（四） 解析漏洞</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、-Apache漏洞分析"><span class="toc-number">3.</span> <span class="toc-text">三、 Apache漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（一）-Apache简介"><span class="toc-number">3.1.</span> <span class="toc-text">（一） Apache简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（二）-解析漏洞"><span class="toc-number">3.2.</span> <span class="toc-text">（二） 解析漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（三）-目录遍历"><span class="toc-number">3.3.</span> <span class="toc-text">（三） 目录遍历</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、-Nginx漏洞分析"><span class="toc-number">4.</span> <span class="toc-text">四、 Nginx漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（一）-Nginx简介"><span class="toc-number">4.1.</span> <span class="toc-text">（一） Nginx简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（二）文件解析"><span class="toc-number">4.2.</span> <span class="toc-text">（二）文件解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（三）目录遍历"><span class="toc-number">4.3.</span> <span class="toc-text">（三）目录遍历</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（四）-CRLF注入"><span class="toc-number">4.4.</span> <span class="toc-text">（四） CRLF注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（五）-目录穿越"><span class="toc-number">4.5.</span> <span class="toc-text">（五） 目录穿越</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、-Tomcat漏洞分析"><span class="toc-number">5.</span> <span class="toc-text">五、 Tomcat漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（一）-Tomcat简介"><span class="toc-number">5.1.</span> <span class="toc-text">（一） Tomcat简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（二）-远程代码执行"><span class="toc-number">5.2.</span> <span class="toc-text">（二） 远程代码执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（三）war后门文件部署"><span class="toc-number">5.3.</span> <span class="toc-text">（三）war后门文件部署</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六、-jBoss漏洞分析"><span class="toc-number">6.</span> <span class="toc-text">六、 jBoss漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（一）-jBoss简介"><span class="toc-number">6.1.</span> <span class="toc-text">（一） jBoss简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（二）-反序列化漏洞"><span class="toc-number">6.2.</span> <span class="toc-text">（二） 反序列化漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（三）-war后门文件部署"><span class="toc-number">6.3.</span> <span class="toc-text">（三） war后门文件部署</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#七、-WebLogic漏洞分析"><span class="toc-number">7.</span> <span class="toc-text">七、 WebLogic漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（一）-WebLogic简介"><span class="toc-number">7.1.</span> <span class="toc-text">（一） WebLogic简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（二）-反序列化漏洞-1"><span class="toc-number">7.2.</span> <span class="toc-text">（二） 反序列化漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（三）-SSRF"><span class="toc-number">7.3.</span> <span class="toc-text">（三） SSRF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（四）-任意文件上传"><span class="toc-number">7.4.</span> <span class="toc-text">（四） 任意文件上传</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（五）-war后门文件部署"><span class="toc-number">7.5.</span> <span class="toc-text">（五） war后门文件部署</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#八、-其它中间件相关漏洞"><span class="toc-number">8.</span> <span class="toc-text">八、 其它中间件相关漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（一）-FastCGI未授权访问、任意命令执行"><span class="toc-number">8.1.</span> <span class="toc-text">（一） FastCGI未授权访问、任意命令执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（二）-PHPCGI远程代码执行"><span class="toc-number">8.2.</span> <span class="toc-text">（二） PHPCGI远程代码执行</span></a></li></ol></li></ol>
    </div>
    
    <div class="back-top iconfont-archer">&#xe639;</div>
    <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
          <div class="sidebar-panel-archives">
    <!-- 在ejs中将archive按照时间排序 -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 48
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
    
    
    
    <div class="archive-year"> 10007 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/07</span><a class="archive-post-title" href= "/10007/06/07/日记/" >日记</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2019 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/24</span><a class="archive-post-title" href= "/2019/10/24/注入点判断/" >注入点判断</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/24</span><a class="archive-post-title" href= "/2019/10/24/web中间件常见漏洞总结/" >web中间件常见漏洞总结</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/03</span><a class="archive-post-title" href= "/2019/10/03/FUZZ工具/" >FUZZ工具</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/03</span><a class="archive-post-title" href= "/2019/10/03/PHP反序列化原理分析/" >PHP反序列化原理分析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/03</span><a class="archive-post-title" href= "/2019/10/03/WFUZZ/" >WFUZZ</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/03</span><a class="archive-post-title" href= "/2019/10/03/Java反序列化漏洞的原理分析/" >Java反序列化漏洞的原理分析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/28</span><a class="archive-post-title" href= "/2019/09/28/Weblogic漏洞/" >Weblogic漏洞</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/28</span><a class="archive-post-title" href= "/2019/09/28/手工注入语句/" >手工注入语句</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/28</span><a class="archive-post-title" href= "/2019/09/28/phpmyadmin写入一句话/" >phpmyadmin写入一句话</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/20</span><a class="archive-post-title" href= "/2019/09/20/webshell/" >记一次webshell</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/11</span><a class="archive-post-title" href= "/2019/09/11/XSS绕过/" >XSS绕过</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/11</span><a class="archive-post-title" href= "/2019/09/11/网络十/" >网络十</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/10</span><a class="archive-post-title" href= "/2019/09/10/网络九/" >网络九</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/09</span><a class="archive-post-title" href= "/2019/09/09/网络六/" >网络六</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/09</span><a class="archive-post-title" href= "/2019/09/09/网络七/" >网络七</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/09</span><a class="archive-post-title" href= "/2019/09/09/网络八/" >网络八</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/04</span><a class="archive-post-title" href= "/2019/09/04/密码学基本概念/" >密码学基本概念</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/04</span><a class="archive-post-title" href= "/2019/09/04/密码学发展历史/" >密码学发展历史</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/31</span><a class="archive-post-title" href= "/2019/08/31/COOKIE/" >COOKIE</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/31</span><a class="archive-post-title" href= "/2019/08/31/爬虫开发基础/" >爬虫开发基础</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/28</span><a class="archive-post-title" href= "/2019/08/28/网络五/" >网络五</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/25</span><a class="archive-post-title" href= "/2019/08/25/渗透简介/" >渗透简介</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/24</span><a class="archive-post-title" href= "/2019/08/24/Off-Path-TCP-Exploit/" >Off-Path TCP Exploit</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/24</span><a class="archive-post-title" href= "/2019/08/24/网络二/" >网络二</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/24</span><a class="archive-post-title" href= "/2019/08/24/网络四/" >网络四</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/24</span><a class="archive-post-title" href= "/2019/08/24/网络一/" >网络一</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/24</span><a class="archive-post-title" href= "/2019/08/24/网络三/" >网络三</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/20</span><a class="archive-post-title" href= "/2019/08/20/双杀Oday复现/" >CVE20188174-双杀0day漏洞复现</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/17</span><a class="archive-post-title" href= "/2019/08/17/Linux内侧/" >Linux内侧</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/17</span><a class="archive-post-title" href= "/2019/08/17/Linux搭建DHCP服务/" >Linux搭建DHCP服务</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/15</span><a class="archive-post-title" href= "/2019/08/15/linux汇总3/" >linux汇总</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/14</span><a class="archive-post-title" href= "/2019/08/14/git常用命令/" >git常用命令</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/14</span><a class="archive-post-title" href= "/2019/08/14/linux汇总2/" >linux汇总</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/13</span><a class="archive-post-title" href= "/2019/08/13/linux汇总/" >linux汇总</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/12</span><a class="archive-post-title" href= "/2019/08/12/OWASP-TOP10/" >OWASP TOP10</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/11</span><a class="archive-post-title" href= "/2019/08/11/XSS-简介/" >XSS简介</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/10</span><a class="archive-post-title" href= "/2019/08/10/xss实战/" >xss实战</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/10</span><a class="archive-post-title" href= "/2019/08/10/权限维持实验/" >权限维持实验</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/10</span><a class="archive-post-title" href= "/2019/08/10/嗅探欺骗实验/" >嗅探欺骗实验</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/10</span><a class="archive-post-title" href= "/2019/08/10/MSF实验/" >MSF实验</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/10</span><a class="archive-post-title" href= "/2019/08/10/日志清除实验/" >日志清除实验</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/10</span><a class="archive-post-title" href= "/2019/08/10/CentOS-7/" >CentOS 7</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/10</span><a class="archive-post-title" href= "/2019/08/10/linux常用命令/" >linux常用命令</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/10</span><a class="archive-post-title" href= "/2019/08/10/windows-server-2008基础/" >windows server 2008基础内容</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/09</span><a class="archive-post-title" href= "/2019/08/09/SRC/" >SRC</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/09</span><a class="archive-post-title" href= "/2019/08/09/metasploit/" >metasploit之后门的生成</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/08</span><a class="archive-post-title" href= "/2019/08/08/hello-world/" >签名</a>
        </li>
    
    </div>
  </div>
        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
    
        <span class="sidebar-tag-name" data-tags="基础"><span class="iconfont-archer">&#xe606;</span>基础</span>
    
        <span class="sidebar-tag-name" data-tags="Python"><span class="iconfont-archer">&#xe606;</span>Python</span>
    
        <span class="sidebar-tag-name" data-tags="Linux"><span class="iconfont-archer">&#xe606;</span>Linux</span>
    
        <span class="sidebar-tag-name" data-tags="漏洞复现"><span class="iconfont-archer">&#xe606;</span>漏洞复现</span>
    
        <span class="sidebar-tag-name" data-tags="漏洞"><span class="iconfont-archer">&#xe606;</span>漏洞</span>
    
        <span class="sidebar-tag-name" data-tags="FUZZ"><span class="iconfont-archer">&#xe606;</span>FUZZ</span>
    
        <span class="sidebar-tag-name" data-tags="XSS"><span class="iconfont-archer">&#xe606;</span>XSS</span>
    
        <span class="sidebar-tag-name" data-tags="git"><span class="iconfont-archer">&#xe606;</span>git</span>
    
        <span class="sidebar-tag-name" data-tags="渗透测试"><span class="iconfont-archer">&#xe606;</span>渗透测试</span>
    
        <span class="sidebar-tag-name" data-tags="后门"><span class="iconfont-archer">&#xe606;</span>后门</span>
    
        <span class="sidebar-tag-name" data-tags="密码学"><span class="iconfont-archer">&#xe606;</span>密码学</span>
    
        <span class="sidebar-tag-name" data-tags="Himawari"><span class="iconfont-archer">&#xe606;</span>Himawari</span>
    
        <span class="sidebar-tag-name" data-tags="SQL注入"><span class="iconfont-archer">&#xe606;</span>SQL注入</span>
    
        <span class="sidebar-tag-name" data-tags="网络基础"><span class="iconfont-archer">&#xe606;</span>网络基础</span>
    
        <span class="sidebar-tag-name" data-tags="反序列化"><span class="iconfont-archer">&#xe606;</span>反序列化</span>
    
        <span class="sidebar-tag-name" data-tags="linux"><span class="iconfont-archer">&#xe606;</span>linux</span>
    
        <span class="sidebar-tag-name" data-tags="OWASP TOP10"><span class="iconfont-archer">&#xe606;</span>OWASP TOP10</span>
    
        <span class="sidebar-tag-name" data-tags="web中间件"><span class="iconfont-archer">&#xe606;</span>web中间件</span>
    
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
    缺失模块。<br/>
    1、请确保node版本大于6.2<br/>
    2、在博客根目录（注意不是archer根目录）执行以下命令：<br/>
    <span style="color: #f75357; font-size: 1rem; line-height: 2rem;">npm i hexo-generator-json-content --save</span><br/>
    3、在根目录_config.yml里添加配置：
    <pre style="color: #787878; font-size: 0.6rem;">
jsonContent:
  meta: false
  pages: false
  posts:
    title: true
    date: true
    path: true
    text: false
    raw: false
    content: false
    slug: false
    updated: false
    comments: false
    link: false
    permalink: false
    excerpt: false
    categories: true
    tags: true</pre>
    </div> 
    <div class="sidebar-tags-list"></div>
</div>
        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>
    </div>
</div> 
    <script>
    var siteMeta = {
        root: "/",
        author: "申子昊"
    }
</script>
    <!-- CDN failover -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ === 'undefined')
        {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js">\x3C/script>')
        }
    </script>
    <script src="/scripts/main.js"></script>
    <!-- algolia -->
    
    <!-- busuanzi  -->
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    <!-- CNZZ  -->
    
    </div>
    <!-- async load share.js -->
    
        <script src="/scripts/share.js" async></script>    
     
    <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>


